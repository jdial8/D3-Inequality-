<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript" src="./d3/d3.min.js"></script>

  
  <title>Wealth Gaps and Distribution</title>
  <style>

    /* svg {
          background-color: #C8C8CC;
        } */


    .wline {
      fill: none;
      stroke: #b44724;
      stroke-width: 3.5px;
    }

    .hline {
      fill: none;
      stroke: #409379;
      stroke-width: 3.5px;
    }

    .aline {
      fill: none;
      stroke: #000026;
      stroke-width: 3.5px;
    }

    .bline {
      fill: none;
      stroke: #C35882;
      stroke-width: 3.5px;
    }

    .bar {
        stroke: #000000;
        stroke-width: 1;
        opacity: .7;
      }

    #linegraph {
      float: left;
      width: 800;
      
    }

    #histogram {
      float: left;
      width: 400;
    }

  </style>

</head>
<body>


    <h2> Wealth Gaps and Distributions in the U.S. </h2>
    <h4> Click to select groups. </h4>

    <p> </p>
    <!-- <button type = 'button' id = 'Race'> All </button> -->
    <button type = 'button' id = 'buttonasian'> Asian </button>
    <button type = 'button' id = 'buttonblack'> Black </button>
    <button type = 'button' id = 'buttonhispanic'> Hispanic </button>
    <button type = 'button' id = 'buttonwhite'> White </button>

    <p class = 'result'> </p> <!--using class instead of id just to show something different-->
    <div class = 'axes'> </div>

<div class = "container"
	<div id = "linegraph"></div>
</div>

<div class = "container2"
  <div id = "histogram"></div>
  <div id = "histogram2"</div>
</div>

<div>
<p>
      <button type = 'button' id = 'reset'> Reset </button>
</p>
</div>

<script>

  var parseTime = d3.timeParse("%Y");

  d3.json("./networth2.json", function(error, data){
    dataset= data;

  
    dataset.forEach(function(d) {
      d.white_not_h = d.white_not_h
      d.black = +d.black
      d.asian = +d.asian
      d.hispanic = +d.hispanic
      d.year =
      d.year = parseTime(d.year);
      //console.log(d)
    });

  	if (error) {
  		console.log(error);
  	}
  	else {
  	makelineg();
    }
  	});

  function makelineg(){
  		//console.log(dataset[0].year);
      //console.log(dataset.filter(function(d){return d.Race_Ethnicity == 'black';}))
  	

  var margin = {top: 200, right: 100, bottom: 25, left: 100};
  var width = 800 - margin.left - margin.right;
  var height = 800 - margin.top - margin.bottom;


  //var xScale = d3.scaleTime()
     //.domain([d3.extent(dataset, function(d) {return d.year})]) 
     //.rangeRound([0, width])

  //var yScale = d3.scaleLinear()
     //.domain([0, d3.max(dataset, function(d) {
        //return Math.max(d.white_not_h, d.black, d.asian, d.hispanic); })]) 
     //.range([height, 0]); //lower values appear lower on the screen

  var x = d3.scaleTime().range([0, width]);
  var y = d3.scaleLinear().range([height, 0])

  // 1st line
  var valueline = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.white_not_h); });

  // 2nd line
  var valueline2 = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.hispanic); });

  //networth2 version
  var ValueLine = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.amount); });


  // create the linechart svg
  var svg = d3.select("#linegraph") //select the class with id barchart
    .append('svg')
    .attr("width", width + margin.right + margin.left)
    .attr("height", height + margin.top + margin.bottom);


  var g = svg.append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.right + ')');

  // create the histogram svgs
  var svg2 = d3.select("#histogram") //select the class with id barchart
      .append('svg')
      .attr("width", 400)
      .attr("height", 400)
      .attr('transform', 'translate(' + 100 + ',' + 0 + ')');

  svg2.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("height", 400)
            .attr("width", 400)
            .style("stroke", "#000000")
            .style("fill", "none")
            .style("stroke-width", 2);

  var svg3 = d3.select("#histogram2") //select the class with id barchart
      .append('svg')
      .attr("width", 400)
      .attr("height", 400)
      .attr('transform', 'translate(' + 100 + ',' + 0 + ')');

  svg3.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("height", 400)
            .attr("width", 400)
            .style("stroke", "#000000")
            .style("fill", "none")
            .style("stroke-width", 2);


  x.domain(d3.extent(dataset, function(d) {return d.year}))
  //y.domain([0, d3.max(dataset, function (d) {
    //return Math.max(d.white_not_h, d.black, d.asian, d.hispanic);}
    //)])
  y.domain([0, d3.max(dataset, function(d) {return d.amount;})])
  

  // bring the data in on click of buttons (networth)
  d3.select('#buttonwhite')
    .on('click', function() {
      // lines
      g.append("path")
        .data([dataset])
        .attr("class", "wline")
        .attr("d", valueline) ;
      // points
      g.selectAll(".dot")
        .data(dataset)
        .enter()
        .append("circle")
        .attr("class", "dot")
        .attr("cx", function(d) {return x(d.year);})
        .attr("cy", function (d) {return y(d.white_not_h)})
        .attr("r", 3.5)
        .on('click', function(d) {console.log(d.year)});
        });


  // make lines after click of button (with networth2)
  d3.select('#buttonwhite')
    .on('click', function() {
      plot(dataset, "white_not_h", "wline", ".dot", "dot");  
      }); 

  d3.select('#buttonhispanic')
    .on('click', function() {
      plot(dataset, "hispanic", "hline", ".dot2", "dot2");
    });

  d3.select('#buttonasian')
    .on('click', function() {
      plot(dataset, "asian", "aline", ".dot3", "dot3");
    });

  d3.select('#buttonblack')
    .on('click', function() {
      plot(dataset, "black", "bline", ".dot4", "dot4");
    });

  //reset button
  d3.select('#reset')
    .on('click', function() {//svg2.selectAll(".bar").remove();
                            svg2.selectAll("g").remove();
                            svg3.selectAll("g").remove(); 
                            svg2.select("text").remove();
                            svg3.select("text").remove();})


  var count = 0;

  var tooltip = d3.select("body")
    .append("div")
    .style("position", "absolute")
    .style("z-index", "10")
    .style("visibility", "hidden")
    .text("a simple tooltip");

  function plot(data, race, lineclass, dot, dotclass) {
    // filter
      data = dataset.filter(function(d){return d.Race_Ethnicity == race;})

    //lines
      g.append("path")
        .data([data])
        .attr("class", lineclass)
        .attr("d", ValueLine) ;

      // points
      g.selectAll(dot)
        .data(data)
        .enter()
        .append("circle")
        .attr("class", dotclass)
        //.attr("class", lineclass)
        .attr("cx", function(d) {return x(d.year);})
        .attr("cy", function (d) {return y(d.amount)})
        .attr("r", 5.5)
        .on('click', function(d) {
          count++;
          console.log(count % 2);
          //console.log(getComputedStyle(document.querySelector(dot)).getPropertyValue('stroke'));
          //console.log(d3.select(this));
          if (count % 2 == 1) {
            makehist(d.year, d.Race_Ethnicity, svg2);
          } else {
            makehist(d.year, d.Race_Ethnicity, svg3);
          }; })
        .on("mouseover", function(d) {
          d3.select(this).attr('fill-opacity', 0.5);
          tooltip.text(d.amount); 
          return tooltip.style("visibility", "visible");})
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
        .on("mouseout", function(d){
          d3.select(this).attr('fill-opacity', 1);
          return tooltip.style("visibility", "hidden");
          });
  };  


  // x axis
  svg.append('g')
    .attr('transform', 'translate(' + margin.left + ',' + 675 + ')')
    .call(d3.axisBottom(x)) 
    .selectAll("text")
    .attr("transform", "rotate(-30)");
    //.attr("x", +10)
    //.attr("y", -15);

  // x axis text
  svg.append("text")
    .attr('transform', 'translate(' + (width + margin.left + margin.right)/2 + ',' + 725 + ')')
    .style("text-anchor", "middle")
    .text("Year");

  // y axis
  svg.append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.right + ')')
    .call(d3.axisLeft(y));

  // y axis text 
  svg.append("text")
    .attr('transform', 'translate('+ margin.left/3 + ',' + (height + margin.top + margin.bottom)/2 + ')rotate(-90)')
    .style("text-anchor", "middle")
    .text("Median Net Worth ($)");

  };


  function practice(y, r) {
    console.log(y)
    console.log(r)
  };


  function makehist(y, r, svg) {

  d3.json("./wealthdist.json", function(error, data){
    
    dataset = data.filter(function (d) { 
      return d.year == y.getFullYear() & d.Race_Ethnicity == r ;});
    
    console.log(r);

    dataset.forEach(function (d) {
      d.Race_Ethnicity = d.Race_Ethnicity
      d.bucket = d.bucket
      d.percent = +d.percent 
      d.year = parseTime(d.year) 
      console.log(d.year);  
      })
      
    console.log(dataset)

    var race = r
    var year = y.getFullYear()

    var margin = {top: 100, right: 40, bottom: 50, left: 60};
    var width = 400 - margin.left - margin.right;
    var height = 800 - margin.top - margin.bottom;


    var xScale = d3.scaleBand()
      .domain(dataset.map(function(d) {return d.bucket}))
      .range([0, width]);

    var yScale = d3.scaleLinear()
     //.domain([0, d3.max(dataset, function(d) {return d.percent;})]) 
     .domain([0, 40]) 
     .range([300, 0]); 


    //var svg2 = d3.select("#histogram") //select the class with id barchart
      //.append('svg')
      //.attr("width", width + margin.left + margin.right)
      //.attr("height", height + margin.top + margin.bottom)
      //.attr('transform', 'translate(' + 100 + ',' + 0 + ')');

    //var g = svg2.append('g')
      //.attr('transform', 'translate(' + margin.left + ',' + margin.right+ ')');

    var g = svg.append('g')
      .attr('transform', 'translate(' + margin.left + ',' + margin.right+ ')');

    g.selectAll(".bar")
      .data(dataset)
      .enter()
      .append("rect")
      .attr("class", "bar")
      .attr("x", function (d) {return xScale(d.bucket);})
      .attr("y", function (d) {return yScale(d.percent);})
      .attr("width", xScale.bandwidth())
      .attr("height", function (d) {return 300 - yScale(d.percent)})
      .attr("fill", function(r) {
        if (race == "white_not_h") {return "#b44724"}
        else if (race == "hispanic") {return "#409379"}
        else if (race == "asian") {return "#000026"}
        else {return "#C35882"}
      });
  
    // graph title
    //svg2.append("text")
    svg.append("text")
      .attr("y", margin.top/3)
      .attr("x", (width + margin.left + margin.right)/2)
      .style("text-anchor", "middle")
      .style("font-size", "16px")
      .text(year + " Distribution of Net Worth ");

    // x axis
    //svg2.append('g')
    svg.append('g')
      .attr('transform', 'translate(' + margin.left + ',' + 350 + ')')
      .call(d3.axisBottom(xScale)) 
      .selectAll("text")
      .attr("transform", "rotate(-30)");

    // y axis
    //svg2.append('g')
    svg.append('g')
      .attr('transform', 'translate(' + margin.left + ',' + margin.right + ')')
      .call(d3.axisLeft(yScale));



    });

  };


</script>

</body>
</html>